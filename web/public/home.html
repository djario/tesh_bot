<!DOCTYPE html>
<html>
<head>
 <meta charset="UTF-8">
 <meta name="description" content="Website for Tesh Bot">
 <meta name="keywords" content="Tesh Bot, Discord,Roleplay">
 <meta name="author" content="Teshi">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Teshboard</title>
 <link rel="stylesheet" href="style.css">
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
 <!-- <base href="http://teshi.vastserve.com" target="_blank"> -->
</head>

<body>
 <nav>
  <div class="topnav">
   <a class="active" href="index.html">Home</a>
   <a href="analytics.html">Analytics</a>
   <a href="settings.html">Settings</a>
   <a href="help.html">Help</a>
   <a href="about.html">About</a>
  </div>
  <div class="login">
   <button onclick="location.href='https://discord.com/api/oauth2/authorize?client_id=869927535473995857&redirect_uri=http%3A%2F%2Flocalhost%3A20000%2F&response_type=token&scope=identify%20guilds%20guilds.members.read'" type="button"><span>Login </span></button>
  </div>
  <div class="navsel">
   <img class="userAvatar" id="userAvatar" src="media/images/pb.webp" alt="user" />
  </div>
  <div class="navsel">
   <img class="guildAvatar" id="guildAvatar" src="media/images/pb.webp" alt="guild" />
  </div>
 </nav>

 <main>
  <br />
  <div class="homestart">
   <h1>Home</h1>
   <script>
    window.onload = () => {
     const fragment = new URLSearchParams(window.location.hash.slice(1));
     if (localStorage['access_token'] === undefined) {
      const [accessToken,
       tokenType] = [fragment.get('access_token'),
       fragment.get('token_type')];
      if (!accessToken) {
       return document.getElementById('login').style.display = 'block';
      }

      localStorage['access_token'] = accessToken;
      localStorage['token_type'] = tokenType;
     }
     const [accessToken,
      tokenType] = [localStorage['access_token'],
      localStorage['token_type']];
     fetch('https://discord.com/api/users/@me', {
      headers: {
       authorization: `${tokenType} ${accessToken}`,
      },
     })
     .then(result => result.json())
     .then(response => {
      const {
       username, discriminator, avatar, id
      } = response;
      document.getElementById("userAvatar").src = "https://cdn.discordapp.com/avatars/"+id+"/"+avatar+".png?size=100";
      document.querySelectorAll(".login").forEach(a=>a.style.display = "none");
      document.querySelectorAll(".navsel").forEach(a=>a.style.display = "initial");
      document.getElementById('id').innerText += username+'#'+discriminator+' '+id;
     })
     .catch(console.error);
    };
   </script>
   <p id="id">
    hi:
   </p>
   <p>
    Willkommen auf dem Teshboard. <br /> Hier kannst du die aktuellen Stats vom <a href="https://discord.gg/2T2NjAeUVP">Canol Fantasy Server</a> anschauen. Ich arbeite dran, dass bald alle Tesh-Server hier einsehbar sind.
   </p>
  </div>
  <div class=homestats>
   <h2>Stats</h2>
   <p id="server">
    ...
   </p>
   <script>
    $(document).ready(function() {
     $.getJSON("...", function(data) {
      document.getElementById("server").innerHTML = "Server ID: "+data.id;
     }).fail(function(error) {
      console.log("An error has occurred.");
     });
    });
   </script>
  </div>
 </main>
 <footer>
  <p>
   Tesh-Bot by Teshi 2022
  </p>
 </footer>
</body>
</html>